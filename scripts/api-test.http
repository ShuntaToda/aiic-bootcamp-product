### 車用品専門ECサイトAPI テスト - REST Client
### API Gateway URL
@baseUrl = https://5y67wr0uvj.execute-api.ap-northeast-1.amazonaws.com/v1

### 変数定義（テスト中に自動で更新されます）
@userId = {{createUser.response.body.user.userId}}
@product1Id = {{createProduct1.response.body.product.productId}}
@product2Id = {{createProduct2.response.body.product.productId}}
@orderId = {{createOrder.response.body.order.orderId}}

################################################################################
# 1. ヘルスチェック
################################################################################

### ヘルスチェック
GET {{baseUrl}}/
Content-Type: application/json

################################################################################
# 2. ユーザー管理
################################################################################

### ユーザー作成
# @name createUser
POST {{baseUrl}}/users
Content-Type: application/json

{
  "email": "test@example.com",
  "name": "テストユーザー",
  "address": {
    "zipCode": "100-0001",
    "prefecture": "東京都",
    "city": "千代田区",
    "street": "千代田1-1-1"
  }
}

### 全ユーザー取得
GET {{baseUrl}}/users
Content-Type: application/json

### ユーザー詳細取得
GET {{baseUrl}}/users/{{userId}}
Content-Type: application/json

### メールアドレスでユーザー検索
GET {{baseUrl}}/users/email/test@example.com
Content-Type: application/json

### ユーザー情報更新
PUT {{baseUrl}}/users/{{userId}}
Content-Type: application/json

{
  "name": "更新されたユーザー",
  "address": {
    "zipCode": "150-0001",
    "prefecture": "東京都",
    "city": "渋谷区",
    "street": "渋谷1-1-1"
  }
}

### ユーザー削除（最後に実行）
# DELETE {{baseUrl}}/users/{{userId}}
# Content-Type: application/json

################################################################################
# 3. 商品管理
################################################################################

### 商品作成 1 - 高性能タイヤ
# @name createProduct1
POST {{baseUrl}}/products
Content-Type: application/json

{
  "name": "ブリヂストン POTENZA S007A 245/40R18",
  "description": "ハイパフォーマンスタイヤ。優れたグリップ力と静粛性を実現",
  "price": 28500,
  "stock": 20,
  "category": "Tires",
  "imageUrl": "https://example.com/tire-potenza.jpg"
}

### 商品作成 2 - エンジンオイル
# @name createProduct2
POST {{baseUrl}}/products
Content-Type: application/json

{
  "name": "Castrol EDGE 5W-30 4L 全合成油",
  "description": "最高級全合成エンジンオイル。優れたエンジン保護性能",
  "price": 5980,
  "stock": 50,
  "category": "Oil",
  "imageUrl": "https://example.com/oil-castrol.jpg"
}

### 商品作成 3 - カーナビ
POST {{baseUrl}}/products
Content-Type: application/json

{
  "name": "パナソニック ストラーダ CN-F1XVD 9インチ",
  "description": "大画面9インチディスプレイ搭載の高性能カーナビゲーション",
  "price": 89800,
  "stock": 15,
  "category": "Electronics",
  "imageUrl": "https://example.com/navi-panasonic.jpg"
}

### 全商品取得
GET {{baseUrl}}/products
Content-Type: application/json

### 商品詳細取得
GET {{baseUrl}}/products/{{product1Id}}
Content-Type: application/json

### 商品更新（価格と在庫を変更）
PUT {{baseUrl}}/products/{{product1Id}}
Content-Type: application/json

{
  "price": 240000,
  "stock": 8
}

### 商品削除（最後に実行）
# DELETE {{baseUrl}}/products/{{product2Id}}
# Content-Type: application/json

################################################################################
# 4. カート管理
################################################################################

### カートに商品追加 1 - タイヤ
POST {{baseUrl}}/carts/{{userId}}/items
Content-Type: application/json

{
  "productId": "{{product1Id}}",
  "quantity": 4
}

### カートに商品追加 2 - エンジンオイル
POST {{baseUrl}}/carts/{{userId}}/items
Content-Type: application/json

{
  "productId": "{{product2Id}}",
  "quantity": 2
}

### ユーザーのカート取得
GET {{baseUrl}}/carts/{{userId}}
Content-Type: application/json

### カート内商品の数量更新（タイヤ数量変更）
PUT {{baseUrl}}/carts/{{userId}}/items/{{product1Id}}
Content-Type: application/json

{
  "quantity": 8
}

### カートから商品削除
DELETE {{baseUrl}}/carts/{{userId}}/items/{{product2Id}}
Content-Type: application/json

### カートをクリア（最後に実行）
# DELETE {{baseUrl}}/carts/{{userId}}
# Content-Type: application/json

################################################################################
# 5. 注文管理
################################################################################

### 注文作成
# @name createOrder
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "userId": "{{userId}}",
  "items": [
    {
      "productId": "{{product1Id}}",
      "quantity": 4,
      "price": 28500
    },
    {
      "productId": "{{product2Id}}",
      "quantity": 2,
      "price": 5980
    }
  ],
  "totalAmount": 125960,
  "shippingAddress": {
    "zipCode": "100-0001",
    "prefecture": "東京都",
    "city": "千代田区",
    "street": "千代田1-1-1"
  }
}

### ユーザーの注文履歴取得
GET {{baseUrl}}/orders/user/{{userId}}
Content-Type: application/json

### 注文詳細取得
GET {{baseUrl}}/orders/{{orderId}}
Content-Type: application/json

### 注文ステータス更新 - processing
PUT {{baseUrl}}/orders/{{orderId}}/status
Content-Type: application/json

{
  "status": "processing"
}

### 注文ステータス更新 - shipped
PUT {{baseUrl}}/orders/{{orderId}}/status
Content-Type: application/json

{
  "status": "shipped"
}

### 注文ステータス更新 - delivered
PUT {{baseUrl}}/orders/{{orderId}}/status
Content-Type: application/json

{
  "status": "delivered"
}

################################################################################
# 6. レビュー管理
################################################################################

### レビュー作成 - 商品1（タイヤ）へのレビュー
# @name createReview
POST {{baseUrl}}/reviews
Content-Type: application/json

{
  "productId": "{{product1Id}}",
  "userId": "{{userId}}",
  "rating": 5,
  "title": "グリップ力抜群！",
  "comment": "雨の日でも安定した走行ができます。静粛性も高く満足しています。"
}

### 商品のレビュー一覧取得
GET {{baseUrl}}/reviews/product/{{product1Id}}
Content-Type: application/json

### ユーザーのレビュー一覧取得
GET {{baseUrl}}/reviews/user/{{userId}}
Content-Type: application/json

### レビュー更新
PUT {{baseUrl}}/reviews/{{product1Id}}/{{createReview.response.body.review.reviewId}}
Content-Type: application/json

{
  "rating": 4,
  "title": "グリップ力が良い",
  "comment": "全体的に満足していますが、価格がやや高めです。"
}

### レビューを参考になったとマーク
POST {{baseUrl}}/reviews/{{product1Id}}/{{createReview.response.body.review.reviewId}}/helpful
Content-Type: application/json

{
  "userId": "another-user-id"
}

### レビュー削除（最後に実行）
# DELETE {{baseUrl}}/reviews/{{product1Id}}/{{createReview.response.body.review.reviewId}}
# Content-Type: application/json

################################################################################
# 7. 商品検索・フィルタリング
################################################################################

### カテゴリで検索 - タイヤ
GET {{baseUrl}}/products/search?category=Tires
Content-Type: application/json

### 価格範囲で検索 - 1万円〜3万円
GET {{baseUrl}}/products/search?minPrice=10000&maxPrice=30000
Content-Type: application/json

### 評価で検索 - 4つ星以上
GET {{baseUrl}}/products/search?minRating=4
Content-Type: application/json

### キーワード検索 - オイル
GET {{baseUrl}}/products/search?keyword=オイル
Content-Type: application/json

### 複合検索 - タイヤカテゴリ、2万円以上、4つ星以上
GET {{baseUrl}}/products/search?category=Tires&minPrice=20000&minRating=4
Content-Type: application/json

### おすすめ商品取得
GET {{baseUrl}}/products/recommendations/{{product1Id}}
Content-Type: application/json

################################################################################
# 8. エラーケースのテスト
################################################################################

### 存在しないユーザー取得（404エラー）
GET {{baseUrl}}/users/non-existent-user-id
Content-Type: application/json

### 存在しない商品取得（404エラー）
GET {{baseUrl}}/products/non-existent-product-id
Content-Type: application/json

### 存在しない注文取得（404エラー）
GET {{baseUrl}}/orders/non-existent-order-id
Content-Type: application/json

### 不正なリクエストボディ（バリデーションエラー）
POST {{baseUrl}}/users
Content-Type: application/json

{
  "invalidField": "test"
}

################################################################################
# クリーンアップ（必要に応じてコメント解除）
################################################################################

### カートをクリア
# DELETE {{baseUrl}}/carts/{{userId}}

### 商品削除
# DELETE {{baseUrl}}/products/{{product1Id}}

### ユーザー削除
# DELETE {{baseUrl}}/users/{{userId}}
